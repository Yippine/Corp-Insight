---
description: AI å·¥å…·ç¨ç«‹åŸŸåå¯¦æ–½è¨ˆç•«ã€‚ç•¶éœ€è¦è¦åŠƒã€åŸ·è¡Œæˆ–å›é¡§ aitools.leopilot.com æ–°åŸŸåè¨­ç½®é€²åº¦æ™‚æ‡‰èª¿ç”¨æ­¤è¦å‰‡ã€‚æœ¬è¦å‰‡ç‚ºæ­¤æ¬¡åŸŸååˆ†é›¢çš„å”¯ä¸€çœŸå¯¦ä¾†æºï¼Œæ¶µè“‹å¾æ‡‰ç”¨ç¨‹å¼èª¿æ•´ã€Nginx é…ç½®åˆ° SEO å„ªåŒ–çš„å®Œæ•´è¡Œå‹•æ–¹æ¡ˆï¼Œæ—¨åœ¨å¯¦ç¾é›¶åœæ©Ÿçš„åŸŸååˆ†é›¢éƒ¨ç½²ã€‚
globs:
alwaysApply: false
---

# ğŸ¯ å°ˆæ¡ˆä»£è™Ÿï¼šAI å·¥å…·åŸŸååˆ†é›¢è¨ˆç•«

## 1. å°ˆæ¡ˆèƒŒæ™¯èˆ‡éœ€æ±‚åˆ†æ

### 1.1 æ¥­å‹™éœ€æ±‚

ä¸»ç®¡è¦æ±‚å»ºç«‹æ–°åŸŸå `aitools.leopilot.com`ï¼Œå°ˆé–€æœå‹™ AI å·¥å…·ç›¸é—œé é¢ï¼š

- å°‡ `corpinsight.leopilot.com/aitool/*` çš„æ‰€æœ‰è·¯ç”±é·ç§»åˆ°æ–°åŸŸå
- å¯¦ç¾ URL çµæ§‹ç°¡åŒ–ï¼š
  - `corpinsight.leopilot.com/aitool/search` â†’ `aitools.leopilot.com/search`
  - `corpinsight.leopilot.com/aitool/detail/*` â†’ `aitools.leopilot.com/detail/*`
- èˆŠè·¯å¾‘å°‡ä¸å†å¯ç”¨ï¼Œè‡ªå‹•è·³è½‰åˆ°æ–°åŸŸå

### 1.2 ç¾æ³åˆ†æ

**ç³»çµ±æ¶æ§‹**ï¼š

- ä¸»å°ˆæ¡ˆé‹è¡Œæ–¼ Docker å®¹å™¨ï¼ˆport 3000ï¼‰
- Nginx ä½œç‚ºåå‘ä»£ç†
- Legacy å°ˆæ¡ˆé‹è¡Œæ–¼ PM2
- å–®ä¸€ç¨‹å¼ç¢¼åº«åŒ…å«æ‰€æœ‰åŠŸèƒ½æ¨¡çµ„

**AI å·¥å…·é é¢çµæ§‹**ï¼š

```
/aitool/
â”œâ”€â”€ search      # æœå°‹é é¢ï¼ˆæ”¯æ´ ?q= å’Œ ?tag= åƒæ•¸ï¼‰
â”œâ”€â”€ detail/
â”‚   â””â”€â”€ [toolId]  # å·¥å…·è©³æƒ…é é¢
â””â”€â”€ (è‡ªå‹•é‡å®šå‘åˆ° /search)
```

### 1.3 æŠ€è¡“è©•ä¼°çµè«–

- âœ… **å¯é€é Nginx + æ‡‰ç”¨å±¤èª¿æ•´å¯¦ç¾**ï¼Œç„¡éœ€æ‹†åˆ†å°ˆæ¡ˆ
- âœ… **ä¿æŒå–®ä¸€ç¨‹å¼ç¢¼åº«**ï¼Œä¾¿æ–¼ç¶­è­·å’ŒåŠŸèƒ½æ•´åˆ
- âœ… **ä½¿ç”¨ aitools è€Œé aitool**ï¼ˆè¤‡æ•¸å½¢å¼æ›´ç¬¦åˆ SEO å’Œä½¿ç”¨ç¿’æ…£ï¼‰

## 2. å¯¦æ–½æ–¹æ¡ˆæ¶æ§‹

```mermaid
graph TD
    subgraph "ä½¿ç”¨è€…è«‹æ±‚"
        A[aitools.leopilot.com/search]
        B[corpinsight.leopilot.com/aitool/search]
    end

    subgraph "Nginx å±¤"
        C[aitools æœå‹™å¡Š<br/>åå‘ä»£ç†ä¸¦æ”¹å¯«è·¯å¾‘]
        D[corpinsight æœå‹™å¡Š<br/>301 é‡å®šå‘]
    end

    subgraph "æ‡‰ç”¨å±¤"
        E[Next.js App<br/>æª¢æ¸¬ä¾†æºåŸŸå]
        F[å‹•æ…‹ç”Ÿæˆæ­£ç¢ºçš„å…§éƒ¨é€£çµ]
    end

    A --> C
    B --> D
    D --> A
    C --> E
    E --> F
```

## 3. é–‹ç™¼ä»»å‹™æ¸…å–®

### Phase 1: æº–å‚™å·¥ä½œ â±ï¸ é è¨ˆ 2 å°æ™‚

- [ ] **1.1 å»ºç«‹æ¸¬è©¦åˆ†æ”¯**

  ```bash
  git checkout -b feature/aitools-domain-separation
  ```

- [ ] **1.2 å‚™ä»½ç¾æœ‰é…ç½®**

  ```bash
  # å‚™ä»½ Nginx é…ç½®
  sudo cp /etc/nginx/conf.d/_leopilot_master.conf /etc/nginx/conf.d/_leopilot_master.conf.backup

  # å‚™ä»½æ‡‰ç”¨ç¨‹å¼é…ç½®
  cp next/src/config/site.ts next/src/config/site.ts.backup
  ```

- [ ] **1.3 æº–å‚™å›æ»¾è…³æœ¬**
  ```bash
  # å‰µå»º scripts/rollback-aitools.sh
  ```

### Phase 2: æ‡‰ç”¨å±¤èª¿æ•´ â±ï¸ é è¨ˆ 4 å°æ™‚

- [ ] **2.1 æ“´å±•åŸŸåé…ç½®ç³»çµ±**

  - ä¿®æ”¹ `next/src/config/site.ts` æ”¯æ´å¤šåŸŸåæ¨¡å¼
  - æ–°å¢åŸŸåæª¢æ¸¬é‚è¼¯

- [ ] **2.2 å»ºç«‹åŸŸåæ„ŸçŸ¥ä¸­é–“ä»¶**

  - åœ¨ `next/src/middleware.ts` æ–°å¢åŸŸåæª¢æ¸¬
  - æ ¹æ“š `X-Original-Host` header åˆ¤æ–·è«‹æ±‚ä¾†æº

- [ ] **2.3 èª¿æ•´é€£çµç”Ÿæˆé‚è¼¯**

  - å‰µå»º `useAiToolsUrl` hook
  - æ›´æ–°æ‰€æœ‰ AI å·¥å…·ç›¸é—œçš„å…§éƒ¨é€£çµ

- [ ] **2.4 æ›´æ–° SEO ç›¸é—œçµ„ä»¶**
  - èª¿æ•´ canonical URLs
  - æ›´æ–° sitemap ç”Ÿæˆé‚è¼¯
  - ä¿®æ”¹ robots.txt

### Phase 3: Nginx é…ç½® â±ï¸ é è¨ˆ 2 å°æ™‚

- [ ] **3.1 ç”³è«‹ SSL è­‰æ›¸**

  ```bash
  # ä½¿ç”¨ Let's Encrypt ç‚º aitools.leopilot.com ç”³è«‹è­‰æ›¸
  sudo certbot certonly --nginx -d aitools.leopilot.com
  ```

- [ ] **3.2 å‰µå»ºæ¸¬è©¦é…ç½®**

  - å»ºç«‹ `/etc/nginx/conf.d/aitools_test.conf`
  - é…ç½®åå‘ä»£ç†è¦å‰‡

- [ ] **3.3 æ¸¬è©¦é…ç½®èªæ³•**
  ```bash
  sudo nginx -t
  ```

### Phase 4: éƒ¨ç½²èˆ‡æ¸¬è©¦ â±ï¸ é è¨ˆ 3 å°æ™‚

- [ ] **4.1 éƒ¨ç½²æ‡‰ç”¨ç¨‹å¼æ›´æ–°**

  ```bash
  cd /home/ec2-user/Corp-Insight/next
  npm run build:prod
  npm run start:prod
  ```

- [ ] **4.2 å•Ÿç”¨ Nginx æ–°é…ç½®**

  ```bash
  # ç§»é™¤æ¸¬è©¦å¾Œç¶´ï¼Œæ­£å¼å•Ÿç”¨
  sudo mv /etc/nginx/conf.d/aitools_test.conf /etc/nginx/conf.d/aitools.conf
  sudo nginx -s reload
  ```

- [ ] **4.3 åŠŸèƒ½æ¸¬è©¦æ¸…å–®**
  - [ ] è¨ªå• `aitools.leopilot.com/search` æ­£å¸¸é¡¯ç¤º
  - [ ] æœå°‹åŠŸèƒ½æ­£å¸¸ï¼ˆåŒ…å«åƒæ•¸ï¼‰
  - [ ] è©³æƒ…é é¢æ­£å¸¸è¼‰å…¥
  - [ ] èˆŠåŸŸåè‡ªå‹•è·³è½‰
  - [ ] å…¶ä»–é é¢ä¸å—å½±éŸ¿

### Phase 5: SEO èˆ‡ç›£æ§ â±ï¸ é è¨ˆ 2 å°æ™‚

- [ ] **5.1 æäº¤æ–°åŸŸååˆ° Google Search Console**
- [ ] **5.2 æ›´æ–° sitemap ä¸¦æäº¤**
- [ ] **5.3 è¨­ç½®ç›£æ§å‘Šè­¦**
- [ ] **5.4 æ›´æ–° Google Analytics**

## 4. å…·é«”å¯¦æ–½ç´°ç¯€

### 4.1 æ‡‰ç”¨å±¤ç¨‹å¼ç¢¼èª¿æ•´

**site.ts é…ç½®æ“´å±•**ï¼š

```typescript
// next/src/config/site.ts
export const SITE_CONFIG = {
  main: {
    domain:
      process.env.NEXT_PUBLIC_SITE_URL || "https://corpinsight.leopilot.com",
    name: "CorpInsight",
  },
  aitools: {
    domain:
      process.env.NEXT_PUBLIC_AITOOLS_URL || "https://aitools.leopilot.com",
    name: "AI Tools",
  },
};

export function getAiToolsUrl(path: string, originalHost?: string) {
  const isAiToolsDomain = originalHost?.includes("aitools");
  if (isAiToolsDomain) {
    return path; // å·²åœ¨ aitools åŸŸåä¸‹ï¼Œè¿”å›ç›¸å°è·¯å¾‘
  }
  return `${SITE_CONFIG.aitools.domain}${path}`;
}
```

### 4.2 Nginx é…ç½®ç¯„ä¾‹

```nginx
# /etc/nginx/conf.d/aitools.conf
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name aitools.leopilot.com;

    ssl_certificate /etc/letsencrypt/live/aitools.leopilot.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/aitools.leopilot.com/privkey.pem;

    # å®‰å…¨æ¨™é ­
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Strict-Transport-Security "max-age=31536000" always;

    location / {
        # é‡å¯«è·¯å¾‘ï¼ŒåŠ ä¸Š /aitool å‰ç¶´
        rewrite ^(.*)$ /aitool$1 break;

        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host corpinsight.leopilot.com;
        proxy_set_header X-Original-Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# åœ¨ä¸»åŸŸåé…ç½®ä¸­åŠ å…¥é‡å®šå‘
# ä¿®æ”¹ /etc/nginx/conf.d/_leopilot_master.conf
location /aitool {
    return 301 https://aitools.leopilot.com$request_uri;
}
```

## 5. æ¸¬è©¦è¨ˆç•«

### 5.1 åŠŸèƒ½æ¸¬è©¦è…³æœ¬

```bash
#!/bin/bash
# test-aitools-domain.sh

echo "=== AI Tools åŸŸåæ¸¬è©¦ ==="

# æ¸¬è©¦æ–°åŸŸåè¨ªå•
echo "1. æ¸¬è©¦æ–°åŸŸåé¦–é "
curl -I https://aitools.leopilot.com/search

# æ¸¬è©¦åƒæ•¸å‚³é
echo "2. æ¸¬è©¦æœå°‹åƒæ•¸"
curl -I "https://aitools.leopilot.com/search?q=chatgpt&tag=writing"

# æ¸¬è©¦èˆŠåŸŸåé‡å®šå‘
echo "3. æ¸¬è©¦èˆŠåŸŸåé‡å®šå‘"
curl -I https://corpinsight.leopilot.com/aitool/search

# æ¸¬è©¦è©³æƒ…é 
echo "4. æ¸¬è©¦è©³æƒ…é é¢"
curl -I https://aitools.leopilot.com/detail/test-tool-id
```

### 5.2 ç›£æ§æª¢æŸ¥é …ç›®

- Nginx error.log ç„¡ç•°å¸¸
- Docker å®¹å™¨é‹è¡Œæ­£å¸¸
- ç¶²ç«™å›æ‡‰æ™‚é–“æ­£å¸¸
- SSL è­‰æ›¸æœ‰æ•ˆ

## 6. å›æ»¾æ–¹æ¡ˆ

å¦‚æœå‡ºç¾å•é¡Œï¼ŒåŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š

```bash
#!/bin/bash
# rollback-aitools.sh

echo "é–‹å§‹å›æ»¾ AI Tools åŸŸåè¨­ç½®..."

# 1. æ¢å¾© Nginx é…ç½®
sudo cp /etc/nginx/conf.d/_leopilot_master.conf.backup /etc/nginx/conf.d/_leopilot_master.conf
sudo rm -f /etc/nginx/conf.d/aitools.conf
sudo nginx -s reload

# 2. æ¢å¾©æ‡‰ç”¨ç¨‹å¼ç¢¼
cd /home/ec2-user/Corp-Insight
git checkout main
git branch -D feature/aitools-domain-separation

# 3. é‡å•Ÿæ‡‰ç”¨
cd next
npm run start:prod

echo "å›æ»¾å®Œæˆï¼"
```

## 7. é¢¨éšªç®¡ç†

### 7.1 å·²è­˜åˆ¥é¢¨éšª

1. **Nginx é…ç½®éŒ¯èª¤**ï¼šå¯èƒ½å°è‡´ç¶²ç«™ç„¡æ³•è¨ªå•

   - ç·©è§£æªæ–½ï¼šå…ˆç”¨æ¸¬è©¦é…ç½®ï¼Œç¢ºèªç„¡èª¤å¾Œå†å•Ÿç”¨

2. **æ‡‰ç”¨ç¨‹å¼éŒ¯èª¤**ï¼šå¯èƒ½å½±éŸ¿åŠŸèƒ½æ­£å¸¸é‹ä½œ

   - ç·©è§£æªæ–½ï¼šå®Œæ•´æ¸¬è©¦å¾Œå†éƒ¨ç½²ï¼Œæº–å‚™å›æ»¾è…³æœ¬

3. **SEO å½±éŸ¿**ï¼šåŸŸåè®Šæ›´å¯èƒ½å½±éŸ¿æœå°‹æ’å
   - ç·©è§£æªæ–½ï¼šæ­£ç¢ºè¨­ç½® 301 é‡å®šå‘å’Œ canonical URLs

### 7.2 å»ºè­°åŸ·è¡Œæ™‚é–“

- é¸æ“‡**é€±æœ«å‡Œæ™¨**æˆ–**æµé‡æœ€ä½æ™‚æ®µ**åŸ·è¡Œ
- é ç•™è‡³å°‘ 4 å°æ™‚çš„ç¶­è­·çª—å£
- å®‰æ’äººå“¡ç›£æ§å’Œæ‡‰æ€¥è™•ç†

## 8. å°ˆæ¡ˆè¿½è¹¤

### é–‹ç™¼æ—¥èªŒ

- `2025-08-05`: `AI/Claude` - å®Œæˆéœ€æ±‚åˆ†æå’ŒæŠ€è¡“æ–¹æ¡ˆè¨­è¨ˆ
- `YYYY-MM-DD`: `[åŸ·è¡Œäºº]` - `[å·¥ä½œæè¿°]`

### é—œéµæ±ºç­–è¨˜éŒ„

1. **ä½¿ç”¨ aitools è€Œé aitool**ï¼šåŸºæ–¼ SEO å’Œä½¿ç”¨ç¿’æ…£è€ƒé‡
2. **ä¸æ‹†åˆ†å°ˆæ¡ˆ**ï¼šä¿æŒç¨‹å¼ç¢¼çµ±ä¸€ç®¡ç†ï¼Œé™ä½ç¶­è­·æˆæœ¬
3. **æ¡ç”¨ Nginx åå‘ä»£ç†æ–¹æ¡ˆ**ï¼šæœ€å°åŒ–ç¨‹å¼ç¢¼æ”¹å‹•

---

_æœ¬æ–‡æª”ç‚º AI Tools åŸŸååˆ†é›¢å°ˆæ¡ˆçš„æ¬Šå¨æŒ‡å—ï¼Œæ‰€æœ‰ç›¸é—œé–‹ç™¼å·¥ä½œæ‡‰åƒç…§æ­¤æ–‡æª”åŸ·è¡Œã€‚_
