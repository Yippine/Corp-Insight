---
description: MongoDB è³‡æ–™åº«æ¶æ§‹è¨­è¨ˆæŒ‡å—ã€‚ç•¶ä½ éœ€è¦æŸ¥è©¢ MongoDB Collections çµæ§‹ã€è³‡æ–™æ¨¡å‹å®šç¾©ã€ç´¢å¼•é…ç½®ã€è³‡æ–™åº«é€£ç·šè¨­å®šï¼Œæˆ–é€²è¡Œè³‡æ–™åº«ç›¸é—œé–‹ç™¼æ™‚èª¿ç”¨æ­¤è¦å‰‡ã€‚æ¶µè“‹ä¼æ¥­è³‡æ–™ã€æ¨™æ¡ˆè³‡æ–™ã€AIå·¥å…·ç­‰æ ¸å¿ƒæ¥­å‹™é›†åˆçš„å®Œæ•´è¨­è¨ˆè¦ç¯„ã€‚
globs: 
alwaysApply: false
---
# Business Magnifier MongoDB å®Œæ•´æ¶æ§‹èˆ‡ç®¡ç†æŒ‡å—

## ğŸ¯ å°ˆæ¡ˆæ¦‚è¿°

Business Magnifier æ˜¯ä¸€å€‹ä¼æ¥­è³‡æ–™åˆ†æå¹³å°ï¼Œä½¿ç”¨ MongoDB ä½œç‚ºä¸»è¦è³‡æ–™åº«ã€‚æœ¬æŒ‡å—æ¶µè“‹å®Œæ•´çš„ MongoDB æ¶æ§‹è¨­è¨ˆã€ç®¡ç†æ“ä½œã€æ•…éšœæ’é™¤ç­‰æ‰€æœ‰ç›¸é—œçŸ¥è­˜ã€‚

## ğŸ“Š è³‡æ–™åº«æ¶æ§‹

**è³‡æ–™åº«åç¨±**: `business-magnifier`  
**MongoDB é€£ç·šå­—ä¸²**: `mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin`

## ğŸ—‚ï¸ å®Œæ•´ Collections æ¸…å–®ï¼ˆ9å€‹ï¼‰

### 1. æ ¸å¿ƒæ¥­å‹™è³‡æ–™ Collections

#### 1.1 `companies` - ä¼æ¥­è³‡æ–™é›†åˆ
**ç”¨é€”**: å„²å­˜å°ç£ä¼æ¥­çš„åŸºæœ¬è³‡æ–™ã€è²¡å‹™è³‡è¨Šã€è‘£ç›£äº‹è³‡æ–™ç­‰å®Œæ•´ä¼æ¥­æª”æ¡ˆ

**ä¸»è¦æ¬„ä½çµæ§‹**:
```javascript
{
  _id: ObjectId,
  taxId: String,           // çµ±ä¸€ç·¨è™Ÿ (å”¯ä¸€è­˜åˆ¥)
  name: String,            // ä¼æ¥­åç¨±
  fullName: String,        // ä¼æ¥­å…¨å
  englishName: String,     // è‹±æ–‡åç¨±
  status: String,          // ä¼æ¥­ç‹€æ…‹ (æ ¸å‡†è¨­ç«‹/æ’¤éŠ·/å»¢æ­¢ç­‰)
  chairman: String,        // è² è²¬äºº
  industry: String,        // è¡Œæ¥­åˆ¥
  address: String,         // åœ°å€
  establishedDate: Date,   // è¨­ç«‹æ—¥æœŸ
  
  // è²¡å‹™è³‡è¨Š
  financial: {
    totalCapital: String,
    paidInCapital: String,
    employees: String,
    revenue: String
  },
  
  // è¯çµ¡è³‡è¨Š
  contact: {
    phone: String,
    email: String,
    website: String,
    fax: String
  },
  
  // ä¸Šå¸‚å…¬å¸è²¡å ±è³‡è¨Š
  financialReport: Object,
  
  // è‘£ç›£äº‹è³‡è¨Š
  directors: [{ name: String, title: String, shares: String, representative: String }],
  
  // ç¶“ç†äººè³‡è¨Š
  managers: [{ åºè™Ÿ: String, å§“å: String, åˆ°è·æ—¥æœŸ: Date }],
  
  // ç‡Ÿæ¥­é …ç›®
  businessScope: [[String]],
  
  // é—œè¯æ¨™æ¡ˆæ•¸é‡
  tenderCount: Number,
  
  // æœå°‹é—œéµå­—
  searchKeywords: [String],
  
  // Sitemap ç›¸é—œ
  sitemapIndexed: Boolean,
  sitemapUrl: String,
  
  // æ™‚é–“æˆ³
  createdAt: Date,
  updatedAt: Date,
  lastUpdated: Date
}
```

**ç´¢å¼•é…ç½®**:
- `{ taxId: 1 }` - çµ±ä¸€ç·¨è™Ÿå”¯ä¸€ç´¢å¼• (unique: true)
- `{ name: "text", fullName: "text" }` - ä¼æ¥­åç¨±å…¨æ–‡æœå°‹ç´¢å¼•
- `{ industry: 1 }` - è¡Œæ¥­åˆ¥ç´¢å¼•
- `{ establishedDate: -1 }` - è¨­ç«‹æ—¥æœŸé™åºç´¢å¼•
- `{ searchKeywords: 1 }` - æœå°‹é—œéµå­—ç´¢å¼•
- `{ tenderCount: -1 }` - æ¨™æ¡ˆæ•¸é‡é™åºç´¢å¼•

#### 1.2 `tenders` - æ”¿åºœæ¨™æ¡ˆè³‡æ–™é›†åˆ
**ç”¨é€”**: å„²å­˜æ”¿åºœæ¡è³¼ç¶²çš„æ¨™æ¡ˆè³‡æ–™ï¼Œç”¨æ–¼ sitemap ç”Ÿæˆå’Œæ¨™æ¡ˆæŸ¥è©¢

**ä¸»è¦æ¬„ä½çµæ§‹**:
```javascript
{
  _id: String,             // æ¨™æ¡ˆå”¯ä¸€è­˜åˆ¥ç¢¼ (unit_id_job_number æ ¼å¼)
  unitId: String,          // æ©Ÿé—œä»£ç¢¼
  jobNumber: String,       // æ¨™æ¡ˆç·¨è™Ÿ
  title: String,           // æ¨™æ¡ˆæ¨™é¡Œ
  unitName: String,        // æ©Ÿé—œåç¨±
  status: String,          // æ¨™æ¡ˆç‹€æ…‹ (active/open/published/closed)
  tenderValue: Number,     // æ¨™æ¡ˆé‡‘é¡
  publishDate: Date,       // ç™¼å¸ƒæ—¥æœŸ
  deadline: Date,          // æˆªæ­¢æ—¥æœŸ
  
  // æ¨™æ¡ˆè©³ç´°è³‡è¨Š
  detail: {
    type: String,          // æ¨™æ¡ˆé¡å‹
    description: String,   // æ¨™æ¡ˆèªªæ˜
    requirements: String,  // éœ€æ±‚è¦æ ¼
    evaluation: String     // è©•é¸æ–¹å¼
  },
  
  // ç›¸é—œä¼æ¥­
  companies: [{
    taxId: String,
    name: String,
    role: String           // å¾—æ¨™å» å•†/æŠ•æ¨™å» å•†
  }],
  
  // Sitemap ç›¸é—œ
  sitemapIndexed: Boolean,
  sitemapUrl: String,
  
  // æ™‚é–“æˆ³
  createdAt: Date,
  updatedAt: Date
}
```

**ç´¢å¼•é…ç½®**:
- `{ _id: 1 }` - ä¸»éµç´¢å¼•
- `{ status: 1 }` - ç‹€æ…‹ç´¢å¼•
- `{ tenderValue: -1 }` - æ¨™æ¡ˆé‡‘é¡é™åºç´¢å¼•
- `{ publishDate: -1 }` - ç™¼å¸ƒæ—¥æœŸé™åºç´¢å¼•
- `{ unitId: 1 }` - æ©Ÿé—œä»£ç¢¼ç´¢å¼•
- `{ jobNumber: 1 }` - æ¨™æ¡ˆç·¨è™Ÿç´¢å¼•
- `{ title: "text" }` - æ¨™æ¡ˆæ¨™é¡Œå…¨æ–‡æœå°‹ç´¢å¼•

#### 1.3 `ai_tools` - AI å·¥å…·è³‡æ–™é›†åˆ
**ç”¨é€”**: å„²å­˜ AI å·¥å…·å’Œæç¤ºè©æ¨¡æ¿ï¼Œæ”¯æ´å·¥å…·åˆ†é¡å’Œä½¿ç”¨çµ±è¨ˆ

**ä¸»è¦æ¬„ä½çµæ§‹**:
```javascript
{
  _id: ObjectId,
  id: String,              // å·¥å…·å”¯ä¸€è­˜åˆ¥ç¢¼
  name: String,            // å·¥å…·åç¨±
  description: String,     // å·¥å…·æè¿°
  category: String,        // åˆ†é¡ (æç¤ºè©/AIå·¥å…·/SEO/å¥åº·ç­‰)
  tags: [String],          // æ¨™ç±¤
  
  // å·¥å…·é…ç½®
  config: {
    icon: String,          // åœ–ç¤º
    placeholder: String,   // è¼¸å…¥æç¤º
    instructions: {        // ä½¿ç”¨èªªæ˜
      what: String,
      why: String,
      how: String
    },
    promptTemplate: {      // æç¤ºè©æ¨¡æ¿
      prefix: String,
      suffix: String
    },
    renderConfig: {        // æ¸²æŸ“é…ç½®
      componentId: String,
      renderType: String,  // 'prompt' | 'component'
      isAITool: Boolean
    }
  },
  
  // ä½¿ç”¨çµ±è¨ˆ
  usage: {
    totalUses: Number,
    lastUsed: Date,
    popularityScore: Number
  },
  
  // ç‰ˆæœ¬æ§åˆ¶
  version: String,
  isActive: Boolean,
  
  // æ™‚é–“æˆ³
  createdAt: Date,
  updatedAt: Date
}
```

**ç´¢å¼•é…ç½®**:
- `{ id: 1 }` - å·¥å…· ID å”¯ä¸€ç´¢å¼• (unique: true)
- `{ category: 1, isActive: 1 }` - åˆ†é¡å’Œå•Ÿç”¨ç‹€æ…‹è¤‡åˆç´¢å¼•
- `{ tags: 1, isActive: 1 }` - æ¨™ç±¤å’Œå•Ÿç”¨ç‹€æ…‹è¤‡åˆç´¢å¼•
- `{ "usage.popularityScore": -1 }` - ä½¿ç”¨ç†±åº¦æ’åºç´¢å¼•
- `{ name: "text", description: "text" }` - å·¥å…·åç¨±å’Œæè¿°å…¨æ–‡æœå°‹ç´¢å¼•

### 2. API å¿«å– Collections

#### 2.1 `pcc_api_cache` - æ”¿åºœæ¡è³¼ç¶² API å¿«å–
**ç”¨é€”**: å¿«å–æ”¿åºœæ¡è³¼ç¶² API å›æ‡‰ï¼Œæ¸›å°‘å¤–éƒ¨ API å‘¼å«ï¼Œæå‡æ•ˆèƒ½

**è³‡æ–™çµæ§‹**:
```javascript
{
  _id: ObjectId,
  api_key: String,         // API è«‹æ±‚çš„å”¯ä¸€éµå€¼ (é€šå¸¸æ˜¯å®Œæ•´ URL)
  data: Mixed,             // å¿«å–çš„ API å›æ‡‰è³‡æ–™
  fetched_at: Date,        // è³‡æ–™æ“·å–æ™‚é–“
  expires_at: Date,        // éæœŸæ™‚é–“ (TTL: 24å°æ™‚)
  request_count: Number,   // è«‹æ±‚æ¬¡æ•¸çµ±è¨ˆ
  last_access: Date        // æœ€å¾Œå­˜å–æ™‚é–“
}
```

**ç´¢å¼•é…ç½®**:
- `{ api_key: 1 }` - API éµå€¼å”¯ä¸€ç´¢å¼• (unique: true)
- `{ expires_at: 1 }` - TTL ç´¢å¼•ï¼Œè‡ªå‹•æ¸…ç†éæœŸè³‡æ–™ (expireAfterSeconds: 0)
- `{ fetched_at: -1 }` - è³‡æ–™æ“·å–æ™‚é–“é™åºç´¢å¼•

#### 2.2 `g0v_company_api_cache` - G0V ä¼æ¥­è³‡æ–™ API å¿«å–
**ç”¨é€”**: å¿«å– G0V ä¼æ¥­è³‡æ–™ API å›æ‡‰ï¼Œç”¨æ–¼æ¨™æ¡ˆç›¸é—œä¼æ¥­è³‡è¨Š

**è³‡æ–™çµæ§‹**:
```javascript
{
  _id: ObjectId,
  api_key: String,         // API è«‹æ±‚çš„å”¯ä¸€éµå€¼
  company_id: String,      // ä¼æ¥­è­˜åˆ¥ç¢¼
  data: Mixed,             // å¿«å–çš„ä¼æ¥­è³‡æ–™
  fetched_at: Date,        // è³‡æ–™æ“·å–æ™‚é–“
  expires_at: Date,        // éæœŸæ™‚é–“ (TTL: 48å°æ™‚)
  data_source: String,     // è³‡æ–™ä¾†æºæ¨™è­˜
  last_access: Date        // æœ€å¾Œå­˜å–æ™‚é–“
}
```

**ç´¢å¼•é…ç½®**:
- `{ api_key: 1 }` - API éµå€¼å”¯ä¸€ç´¢å¼• (unique: true)
- `{ company_id: 1 }` - ä¼æ¥­è­˜åˆ¥ç¢¼ç´¢å¼•
- `{ expires_at: 1 }` - TTL ç´¢å¼• (expireAfterSeconds: 0)
- `{ fetched_at: -1 }` - æ“·å–æ™‚é–“é™åºç´¢å¼•

#### 2.3 `twincn_api_cache` - å°ç£ä¼æ¥­ç¶² API å¿«å–
**ç”¨é€”**: å¿«å–å°ç£ä¼æ¥­ç¶²è‚¡å‹™è³‡è¨Š API å›æ‡‰

**è³‡æ–™çµæ§‹**:
```javascript
{
  _id: ObjectId,
  api_key: String,         // API è«‹æ±‚çš„å”¯ä¸€éµå€¼
  company_taxid: String,   // ä¼æ¥­çµ±ä¸€ç·¨è™Ÿ
  data: Mixed,             // å¿«å–çš„è‚¡å‹™è³‡è¨Š
  fetched_at: Date,        // è³‡æ–™æ“·å–æ™‚é–“
  expires_at: Date,        // éæœŸæ™‚é–“ (TTL: 72å°æ™‚)
  data_type: String,       // è³‡æ–™é¡å‹ (stock_info/financial_report)
  last_access: Date        // æœ€å¾Œå­˜å–æ™‚é–“
}
```

**ç´¢å¼•é…ç½®**:
- `{ api_key: 1 }` - API éµå€¼å”¯ä¸€ç´¢å¼• (unique: true)
- `{ company_taxid: 1 }` - ä¼æ¥­çµ±ä¸€ç·¨è™Ÿç´¢å¼•
- `{ expires_at: 1 }` - TTL ç´¢å¼• (expireAfterSeconds: 0)
- `{ data_type: 1 }` - è³‡æ–™é¡å‹ç´¢å¼•

### 3. ç³»çµ±æ—¥èªŒ Collections

#### 3.1 `email_verification_log` - Email é©—è­‰æ—¥èªŒ
**ç”¨é€”**: è¨˜éŒ„ Email é©—è­‰ç¢¼ç™¼é€å’Œé©—è­‰éç¨‹

**è³‡æ–™çµæ§‹**:
```javascript
{
  _id: ObjectId,
  email: String,           // æ”¶ä»¶äºº Email
  verification_code: String, // é©—è­‰ç¢¼
  purpose: String,         // é©—è­‰ç›®çš„ (signup/reset_password/change_email)
  status: String,          // ç‹€æ…‹ (sent/verified/expired/failed)
  attempts: Number,        // å˜—è©¦æ¬¡æ•¸
  ip_address: String,      // è«‹æ±‚ä¾†æº IP
  user_agent: String,      // ä½¿ç”¨è€…ä»£ç†
  sent_at: Date,           // ç™¼é€æ™‚é–“
  verified_at: Date,       // é©—è­‰æ™‚é–“
  expires_at: Date,        // éæœŸæ™‚é–“ (TTL: 30åˆ†é˜)
  created_at: Date,        // å»ºç«‹æ™‚é–“
  updated_at: Date         // æ›´æ–°æ™‚é–“
}
```

**ç´¢å¼•é…ç½®**:
- `{ email: 1, verification_code: 1 }` - Email å’Œé©—è­‰ç¢¼è¤‡åˆç´¢å¼•
- `{ expires_at: 1 }` - TTL ç´¢å¼• (expireAfterSeconds: 0)
- `{ status: 1 }` - ç‹€æ…‹ç´¢å¼•
- `{ created_at: -1 }` - å»ºç«‹æ™‚é–“é™åºç´¢å¼•

#### 3.2 `feedback_submissions_log` - æ„è¦‹å›é¥‹æäº¤æ—¥èªŒ
**ç”¨é€”**: è¨˜éŒ„ä½¿ç”¨è€…æ„è¦‹å›é¥‹æäº¤ç´€éŒ„

**è³‡æ–™çµæ§‹**:
```javascript
{
  _id: ObjectId,
  user_id: String,         // ä½¿ç”¨è€… ID (å¯é¸)
  email: String,           // è¯çµ¡ Email
  name: String,            // ä½¿ç”¨è€…å§“å
  subject: String,         // ä¸»é¡Œ
  message: String,         // æ„è¦‹å…§å®¹
  category: String,        // åˆ†é¡ (bug/feature/general/complaint)
  priority: String,        // å„ªå…ˆç´š (low/medium/high/urgent)
  status: String,          // ç‹€æ…‹ (new/in_progress/resolved/closed)
  tags: [String],          // æ¨™ç±¤
  attachments: [{          // é™„ä»¶
    filename: String,
    url: String,
    size: Number
  }],
  ip_address: String,      // æäº¤ä¾†æº IP
  user_agent: String,      // ä½¿ç”¨è€…ä»£ç†
  response: {              // å›è¦†è³‡è¨Š
    admin_id: String,
    response_message: String,
    response_at: Date
  },
  created_at: Date,        // æäº¤æ™‚é–“
  updated_at: Date         // æ›´æ–°æ™‚é–“
}
```

**ç´¢å¼•é…ç½®**:
- `{ status: 1 }` - ç‹€æ…‹ç´¢å¼•
- `{ category: 1 }` - åˆ†é¡ç´¢å¼•
- `{ priority: 1 }` - å„ªå…ˆç´šç´¢å¼•
- `{ email: 1 }` - Email ç´¢å¼•
- `{ created_at: -1 }` - æäº¤æ™‚é–“é™åºç´¢å¼•
- `{ tags: 1 }` - æ¨™ç±¤ç´¢å¼•

## ğŸ› ï¸ è³‡æ–™åº«é€£ç·šèˆ‡è¨­å®š

### ç’°å¢ƒé…ç½®
```javascript
// .env.local
MONGODB_URI=mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin

// ç”Ÿç”¢ç’°å¢ƒ
MONGODB_URI=mongodb://admin:password@mongodb.example.com:27017/business-magnifier?authSource=admin&ssl=true
```

### é€£ç·šè¨­å®š (Connection.ts)
```javascript
import mongoose from 'mongoose';

const MONGODB_URI = process.env.MONGODB_URI || 'mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin';

const connection = { isConnected: 0 };

export async function connectToDatabase() {
  if (connection.isConnected) {
    return mongoose;
  }

  try {
    const db = await mongoose.connect(MONGODB_URI, {
      bufferCommands: false,
      maxPoolSize: 10,
      serverSelectionTimeoutMS: 5000,
      socketTimeoutMS: 45000,
      connectTimeoutMS: 10000,
      family: 4,
      retryWrites: true,
      w: 'majority',
    });

    connection.isConnected = db.connections[0].readyState;
    console.log('âœ… MongoDB é€£ç·šæˆåŠŸ');
    return db;
  } catch (error) {
    console.error('âŒ MongoDB é€£ç·šå¤±æ•—:', error);
    throw error;
  }
}
```

## ğŸš€ MongoDB Collections åˆå§‹åŒ–èˆ‡ç®¡ç†

### å¿«é€Ÿé‡å»ºæŒ‡ä»¤

**ä¸€éµé‡å»ºæ‰€æœ‰ Collectionsï¼š**
```bash
# åœ¨ next ç›®éŒ„ä¸‹åŸ·è¡Œ
npm run db:setup
```

**åƒ…åˆå§‹åŒ– Collectionsï¼ˆä¸é‡å•Ÿå®¹å™¨ï¼‰ï¼š**
```bash
npm run db:init
```

**åˆ†æ­¥åŸ·è¡Œï¼š**
```bash
# 1. å•Ÿå‹• MongoDB å®¹å™¨
npm run docker:mongo

# 2. ç­‰å¾… MongoDB å®Œå…¨å•Ÿå‹•ï¼ˆ30-60ç§’ï¼‰
docker logs mongo

# 3. åˆå§‹åŒ– Collections
npm run db:init
```

### é©—è­‰ Collections å»ºç«‹ç‹€æ³

**ä½¿ç”¨ MongoDB Shell æª¢æŸ¥ï¼š**
```bash
# é€£æ¥åˆ° MongoDB
npm run db:connect-docker

# åœ¨ MongoDB Shell ä¸­åŸ·è¡Œ
use business-magnifier
show collections
db.companies.getIndexes()
```

**ä½¿ç”¨ MongoDB Express ç®¡ç†ä»‹é¢ï¼š**
```bash
# å•Ÿå‹•ç®¡ç†ä»‹é¢
npm run docker:tools

# ç€è¦½å™¨è¨ªå•: http://localhost:8081
```

**ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼ API æª¢æŸ¥ï¼š**
```bash
# å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
npm run dev

# æª¢æŸ¥ API ç«¯é»
curl http://localhost:3000/api/health
```

## ğŸ”§ æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ³•

#### 1. Docker æœå‹™æœªå•Ÿå‹•
```
âŒ Docker æœå‹™æœªé‹è¡Œ
ğŸ’¡ è«‹å•Ÿå‹• Docker Desktop
```
**è§£æ±ºæ–¹æ³•ï¼š** å•Ÿå‹• Docker Desktop ä¸¦ç­‰å¾…å…¶å®Œå…¨è¼‰å…¥

#### 2. MongoDB é€£ç·šå¤±æ•—
```
âŒ MongoDB é€£ç·šå¤±æ•—: ECONNREFUSED
```
**è§£æ±ºæ–¹æ³•ï¼š**
- ç¢ºèª MongoDB å®¹å™¨æ­£åœ¨é‹è¡Œï¼š`docker ps | grep mongo`
- ç­‰å¾…æ›´é•·æ™‚é–“è®“ MongoDB å®Œå…¨å•Ÿå‹•
- æª¢æŸ¥åŸ å£ 27017 æ˜¯å¦è¢«å ç”¨

#### 3. èªè­‰å¤±æ•—
```
âŒ Authentication failed
```
**è§£æ±ºæ–¹æ³•ï¼š**
- ç¢ºèªä½¿ç”¨æ­£ç¢ºçš„é€£ç·šå­—ä¸²
- æª¢æŸ¥ `docker-compose.yml` ä¸­çš„èªè­‰è¨­å®š
- é‡æ–°å»ºç«‹ MongoDB å®¹å™¨

#### 4. ç´¢å¼•å»ºç«‹è¡çª
```
âš ï¸ ç´¢å¼•å·²å­˜åœ¨ä½†é…ç½®ä¸åŒï¼Œå˜—è©¦é‡å»ºä¸­...
```
**è§£æ±ºæ–¹æ³•ï¼š** è…³æœ¬æœƒè‡ªå‹•è™•ç†ç´¢å¼•è¡çªï¼Œé‡å»ºä¸ç›¸å®¹çš„ç´¢å¼•

### é‡ç½®æ•´å€‹ MongoDB ç’°å¢ƒ

å¦‚æœé‡åˆ°åš´é‡å•é¡Œï¼Œå¯ä»¥å®Œå…¨é‡ç½®ï¼š

```bash
# åœæ­¢æ‰€æœ‰æœå‹™
npm run stop

# æ¸…ç† Docker è³‡æº
npm run docker:cleanup

# ç§»é™¤ MongoDB è³‡æ–™å·
docker volume rm next_mongodb_data

# é‡æ–°å•Ÿå‹•
npm run db:setup
```

## ğŸ’¡ æ•ˆèƒ½å„ªåŒ–èˆ‡æœ€ä½³å¯¦è¸

### ç´¢å¼•å„ªåŒ–ç­–ç•¥
1. **æŸ¥è©¢å°å‘ç´¢å¼•**ï¼šåŸºæ–¼å¯¦éš›æŸ¥è©¢æ¨¡å¼å»ºç«‹ç´¢å¼•
2. **è¤‡åˆç´¢å¼•é †åº**ï¼šé«˜é¸æ“‡æ€§æ¬„ä½åœ¨å‰
3. **TTL ç´¢å¼•**ï¼šè‡ªå‹•æ¸…ç†éæœŸè³‡æ–™
4. **å…¨æ–‡æœç´¢**ï¼šé©ç•¶ä½¿ç”¨æ–‡å­—ç´¢å¼•

### å¿«å–ç®¡ç†
1. **åˆ†å±¤å¿«å–**ï¼šä¸åŒ API ä½¿ç”¨ä¸åŒçš„éæœŸæ™‚é–“
2. **å¿«å–é ç†±**ï¼šé—œéµè³‡æ–™é å…ˆè¼‰å…¥
3. **å¿«å–æ›´æ–°**ï¼šè³‡æ–™è®Šæ›´æ™‚ä¸»å‹•æ›´æ–°å¿«å–
4. **å¿«å–ç›£æ§**ï¼šè¿½è¹¤å¿«å–å‘½ä¸­ç‡

### æ•ˆèƒ½ç›£æ§
```bash
# è³‡æ–™åº«çµ±è¨ˆ
mongosh "mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin" --eval "db.stats()"

# ç´¢å¼•ä½¿ç”¨ç‹€æ³
db.companies.aggregate([{$indexStats: {}}])

# æŸ¥è©¢æ•ˆèƒ½åˆ†æ
db.companies.find({taxId: "12345678"}).explain("executionStats")
```

## ğŸ“Š å‚™ä»½èˆ‡é‚„åŸ

### è‡ªå‹•å‚™ä»½
```bash
# å®Œæ•´è³‡æ–™åº«å‚™ä»½
mongodump --uri="mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin" --out=./backup/$(date +%Y%m%d_%H%M%S)

# ç‰¹å®š Collection å‚™ä»½
mongodump --uri="mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin" --collection=ai_tools --out=./backup/ai_tools_$(date +%Y%m%d_%H%M%S)
```

### é‚„åŸè³‡æ–™
```bash
# å®Œæ•´é‚„åŸ
mongorestore --uri="mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin" ./backup/20240610_143000/business-magnifier/

# ç‰¹å®š Collection é‚„åŸ
mongorestore --uri="mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin" --collection=ai_tools ./backup/ai_tools_20240610_143000/business-magnifier/ai_tools.bson
```

## ğŸ“‹ é€£ç·šè³‡è¨Š

- **é€£ç·šå­—ä¸²ï¼š** `mongodb://admin:password@localhost:27017/business-magnifier?authSource=admin`
- **è³‡æ–™åº«åç¨±ï¼š** `business-magnifier`
- **ä½¿ç”¨è€…åç¨±ï¼š** `admin`
- **å¯†ç¢¼ï¼š** `password`
- **ç®¡ç†ä»‹é¢ï¼š** http://localhost:8081 (éœ€å…ˆåŸ·è¡Œ `npm run docker:tools`)

## ğŸ¯ é–‹ç™¼æŒ‡å—

### æ–°å¢ Collection
1. åœ¨æ­¤è¦å‰‡æ–‡ä»¶ä¸­å®šç¾© Collection çµæ§‹
2. æ›´æ–° `scripts/init-mongodb-collections.js` 
3. å»ºç«‹å°æ‡‰çš„ Mongoose æ¨¡å‹
4. åŸ·è¡Œ `npm run db:init` é‡æ–°åˆå§‹åŒ–

### ä¿®æ”¹ç´¢å¼•
1. æ›´æ–°æ­¤è¦å‰‡æ–‡ä»¶ä¸­çš„ç´¢å¼•é…ç½®
2. ä¿®æ”¹åˆå§‹åŒ–è…³æœ¬
3. é‡æ–°åŸ·è¡Œåˆå§‹åŒ–ï¼ˆæœƒè‡ªå‹•è™•ç†ç´¢å¼•è®Šæ›´ï¼‰

### è³‡æ–™é·ç§»
1. å»ºç«‹é·ç§»è…³æœ¬
2. åœ¨æ¸¬è©¦ç’°å¢ƒé©—è­‰
3. åŸ·è¡Œç”Ÿç”¢ç’°å¢ƒé·ç§»
4. é©—è­‰è³‡æ–™å®Œæ•´æ€§

---

## ğŸ’¡ å°ˆå®¶å»ºè­°

### è¨­è¨ˆåŸå‰‡
1. **è³‡æ–™æ­£è¦åŒ–**ï¼šé©åº¦æ­£è¦åŒ–ï¼Œé¿å…éåº¦æ­£è¦åŒ–å½±éŸ¿æŸ¥è©¢æ•ˆèƒ½
2. **ç´¢å¼•ç­–ç•¥**ï¼šåŸºæ–¼æŸ¥è©¢æ¨¡å¼å»ºç«‹ç´¢å¼•ï¼Œé¿å…å»ºç«‹éå¤šç´¢å¼•
3. **TTL ç®¡ç†**ï¼šä½¿ç”¨ TTL ç´¢å¼•è‡ªå‹•æ¸…ç†éæœŸçš„å¿«å–è³‡æ–™
4. **å‚™ä»½ç­–ç•¥**ï¼šå®šæœŸå‚™ä»½é‡è¦è³‡æ–™ï¼Œæ¸¬è©¦é‚„åŸæµç¨‹

### å®‰å…¨æ€§è€ƒé‡
1. **èªè­‰æ©Ÿåˆ¶**ï¼šå•Ÿç”¨ MongoDB èªè­‰
2. **ç¶²è·¯å®‰å…¨**ï¼šé™åˆ¶ç¶²è·¯å­˜å–ï¼Œä½¿ç”¨ SSL/TLS 
3. **æ¬Šé™æ§åˆ¶**ï¼šå¯¦æ–½æœ€å°æ¬Šé™åŸå‰‡
4. **è³‡æ–™åŠ å¯†**ï¼šæ•æ„Ÿè³‡æ–™é€²è¡ŒåŠ å¯†å„²å­˜

### ç›£æ§èˆ‡ç¶­è­·
1. **æ•ˆèƒ½ç›£æ§**ï¼šå®šæœŸæª¢æŸ¥æŸ¥è©¢æ•ˆèƒ½
2. **å®¹é‡è¦åŠƒ**ï¼šç›£æ§è³‡æ–™å¢é•·è¶¨å‹¢
3. **æ—¥èªŒåˆ†æ**ï¼šåˆ†æç³»çµ±æ—¥èªŒç™¼ç¾æ½›åœ¨å•é¡Œ
4. **å®šæœŸç¶­è­·**ï¼šåŸ·è¡Œè³‡æ–™åº«å„ªåŒ–å’Œæ¸…ç†ä½œæ¥­