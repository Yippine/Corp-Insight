---
description: 
globs: 
alwaysApply: true
---
# ğŸ¯ å°ˆæ¡ˆä»£è™Ÿï¼šAdmin Console é–‹ç™¼è—åœ–

## 1. èƒŒæ™¯èˆ‡å‹•æ©Ÿ (Background & Motivation)

### 1.1. å¾…è§£æ±ºå•é¡Œ
éš¨è‘—å°ˆæ¡ˆåŠŸèƒ½æ—¥è¶¨è¤‡é›œï¼Œé–‹ç™¼èˆ‡ç¶­é‹æ‰€éœ€çš„ `npm scripts` æ•¸é‡ä¸æ–·å¢é•·ã€‚ç›®å‰å®Œå…¨ä¾è³´é–‹ç™¼äººå“¡æ‰‹å‹•åœ¨çµ‚ç«¯æ©ŸåŸ·è¡ŒæŒ‡ä»¤ï¼Œå¸¶ä¾†ä»¥ä¸‹æŒ‘æˆ°ï¼š
- **æ“ä½œé¢¨éšªé«˜**: `db:restore`, `db:clean` ç­‰é«˜é¢¨éšªæŒ‡ä»¤å­˜åœ¨èª¤æ“ä½œå¯èƒ½ã€‚
- **æ•ˆç‡ä½ä¸‹**: é–‹ç™¼äººå“¡éœ€è¨˜æ†¶å¤šå€‹æŒ‡ä»¤ï¼Œä¸¦åœ¨ä¸åŒå·¥å…·é–“åˆ‡æ›ï¼Œç„¡æ³•ä¸€ç«™å¼ç®¡ç†ã€‚
- **çŸ¥è­˜å­¤å³¶**: å°æŒ‡ä»¤ä¸ç†Ÿæ‚‰çš„é–‹ç™¼è€…é›£ä»¥ä¸Šæ‰‹ï¼Œç¶­é‹çŸ¥è­˜é›£ä»¥å‚³æ‰¿ã€‚
- **ç¼ºä¹åé¥‹**: çµ‚ç«¯æ©ŸæŒ‡ä»¤çš„åŸ·è¡Œéç¨‹èˆ‡çµæœä¸é€æ˜ï¼Œé›£ä»¥è¿½è¹¤ã€‚

### 1.2. å°ˆæ¡ˆç›®æ¨™
æœ¬å°ˆæ¡ˆæ—¨åœ¨å»ºç«‹ä¸€å€‹ä½æ–¼ `/admin/*` ä¸‹çš„å…§éƒ¨ã€Œ**é–‹ç™¼äººå“¡ç¶­é‹æ§åˆ¶å° (Developer Operations Console)**ã€ã€‚æ­¤æ§åˆ¶å°å°‡å–ä»£æ‰‹å‹•æŒ‡ä»¤ï¼Œæä¾›ä¸€å€‹**å®‰å…¨ã€é«˜æ•ˆã€æ˜“ç”¨**çš„ Web ä»‹é¢ä¾†ç®¡ç†æ—¥å¸¸é–‹ç™¼èˆ‡ç¶­é‹ä»»å‹™ï¼Œå¾è€Œå°‡ç¶­é‹å·¥ä½œæµç¨‹åŒ–ã€æ¨™æº–åŒ–ã€‚

æ¯å€‹æ§åˆ¶å°é é¢éƒ½æ‡‰æ˜¯ä¸€å€‹**æ•´åˆå¼çš„å¤šåŠŸèƒ½å·¥ä½œå°**ï¼Œè€Œä¸åƒ…åƒ…æ˜¯æŒ‰éˆ•çš„é›†åˆï¼Œéœ€åŒ…å«ï¼š
- **ç‹€æ…‹ç¸½è¦½ (Monitoring)**: ä»¥å„€è¡¨æ¿å½¢å¼å‘ˆç¾é—œéµæŒ‡æ¨™ã€‚
- **è©³ç´°ç‹€æ…‹ (Detailed View)**: ä»¥å¡ç‰‡å½¢å¼å±•ç¤ºå„å€‹é …ç›®çš„å…·é«”æ•¸æ“šã€‚
- **å…§å®¹æª¢è¦– (Inspection)**: æä¾›é å…§æª¢è¦–å™¨ä»¥æŸ¥çœ‹åŸå§‹æ•¸æ“šæˆ–æ—¥èªŒã€‚
- **æ“ä½œç®¡ç† (Management)**: æä¾›ä¸€å€‹ä½ˆå±€å„ªé›…ã€é«˜å¯è®€æ€§çš„æ“ä½œå€å¡Šï¼ŒåŒ…å«ç¨ç«‹çš„çµ‚ç«¯æ©Ÿè¦–çª—ï¼Œä»¥å®‰å…¨åœ°åŸ·è¡Œ `npm script`ã€‚

## 2. æ¶æ§‹æ¦‚è¦½ (Architecture Overview)

æœ¬å°ˆæ¡ˆæ¡ç”¨å‰å¾Œç«¯åˆ†é›¢çš„æ¶æ§‹ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š

```mermaid
graph TD
    subgraph "Frontend (Next.js)"
        A[Admin Page: e.g., /admin/sitemap] --> B{FeatureConsole Component};
        B --> C[StatsDashboard];
        B --> D[StatusCard Grid];
        B --> E[ContentViewer];
        B --> F[Task Automation Section];
        F --> G[Task Buttons];
        F --> H[TerminalViewer];
    end

    subgraph "Backend (Next.js API Route)"
        G -- "API Request (scriptName)" --> I[/api/admin/run-script];
    end

    subgraph "Server-Side Execution"
        I -- "Validate & Execute" --> J[child_process.spawn("npm", ["run", scriptName])];
        J -- "Stream stdout/stderr" --> I;
    end

    I -- "Stream Response" --> H;

    style A fill:#D6EAF8,stroke:#333,stroke-width:2px
    style B fill:#D1F2EB,stroke:#333,stroke-width:2px
    style C fill:#E8DAEF,stroke:#333,stroke-width:1px
    style D fill:#E8DAEF,stroke:#333,stroke-width:1px
    style E fill:#E8DAEF,stroke:#333,stroke-width:1px
    style F fill:#FDEDEC,stroke:#333,stroke-width:2px
    style G fill:#FDF2E9,stroke:#333,stroke-width:1px
    style H fill:#FDF2E9,stroke:#333,stroke-width:1px
    style I fill:#FAD7A0,stroke:#333,stroke-width:2px
    style J fill:#FEF9E7,stroke:#333,stroke-width:2px
```

- **å‰ç«¯**: ç”±å¤šå€‹ç®¡ç†é é¢ (`/admin/*`) çµ„æˆï¼Œæ¯å€‹é é¢ä½¿ç”¨ä¸€å€‹æ ¸å¿ƒçš„**åŠŸèƒ½æ§åˆ¶å°å…ƒä»¶** (å¦‚ `SitemapConsole.tsx`) ä¾†çµ„ç¹” UIã€‚è©²å…ƒä»¶å…§éƒ¨åŒ…å«å„€è¡¨æ¿ã€ç‹€æ…‹å¡ç‰‡ã€å…§å®¹æª¢è¦–å™¨ï¼Œä»¥åŠä¸€å€‹åŒ…å«ä»»å‹™æŒ‰éˆ•å’Œç¨ç«‹çµ‚ç«¯æ©Ÿè¦–çª—çš„æ“ä½œå€å¡Šã€‚
- **å¾Œç«¯**: ä¸€å€‹çµ±ä¸€çš„ API ç«¯é» (`/api/admin/run-script`) è² è²¬æ¥æ”¶å‰ç«¯è«‹æ±‚ã€‚
- **åŸ·è¡Œå±¤**: API ç«¯é»æœƒé©—è­‰è…³æœ¬åç¨±çš„åˆæ³•æ€§ï¼Œç„¶å¾Œä½¿ç”¨ `child_process.spawn` å®‰å…¨åœ°åŸ·è¡Œå°æ‡‰çš„ `npm script`ï¼Œä¸¦å°‡è¼¸å‡ºä»¥ä¸²æµå½¢å¼å³æ™‚å›å‚³çµ¦å‰ç«¯ã€‚

## 3. é–‹ç™¼è¦æ ¼èˆ‡ä»»å‹™ (SOP)

### Phase 1: åŸºç¤æ¶æ§‹èˆ‡é»ƒé‡‘æ¨™æº–å»ºç«‹

**ç›®æ¨™**: å»ºç«‹ Admin Console çš„åŸºç¤ï¼Œä¸¦å°‡ `sitemap` åŠŸèƒ½é é¢ä½œç‚ºå¾ŒçºŒæ‰€æœ‰é é¢çš„ã€Œé»ƒé‡‘æ¨™æº–ç¯„æœ¬ã€ã€‚

- **[x] 1.1: å»ºç«‹ Admin å°ˆç”¨ä½ˆå±€**
- **[x] 1.2: å»ºç«‹å¾Œç«¯è…³æœ¬åŸ·è¡Œ API**
- **[x] 1.3: æ›´æ–° `development-conventions.mdc` è¦å‰‡**
- **[x] 1.4: (REBUILT & REFINED) é‡å»ºä¸¦å„ªåŒ– Sitemap æ•´åˆæ§åˆ¶å°**
    - **ä½ç½®**: `/admin/sitemap`
    - **ç›®æ¨™**: å»ºç«‹ä¸€å€‹åŠŸèƒ½å®Œæ•´ã€ä½ˆå±€å„ªé›…çš„ Sitemap æ§åˆ¶å°ï¼Œä½œç‚ºå¾ŒçºŒæ‰€æœ‰é é¢çš„ç¯„æœ¬ã€‚
    - **å‹•ä½œ**:
        - å»ºç«‹æ ¸å¿ƒå…ƒä»¶ `SitemapConsole.tsx`ï¼Œæ•´åˆå„€è¡¨æ¿ã€ä¸‰æ¬„å¼ç‹€æ…‹å¡ç‰‡ã€é å…§å…§å®¹æª¢è¦–å™¨ (`SitemapContentViewer.tsx`)ã€‚
        - å»ºç«‹ä¸€å€‹å…¨æ–°çš„å…©æ¬„å¼ã€Œè‡ªå‹•åŒ–ç®¡ç†ã€å€å¡Šï¼Œå·¦å´ç‚ºä»»å‹™æŒ‰éˆ•ï¼Œå³å´ç‚ºä¸€å€‹ç¨ç«‹ã€å¯é—œé–‰çš„ `TerminalViewer.tsx` å…ƒä»¶ã€‚
        - ç¢ºä¿é é¢ç¬¦åˆ Admin Console çš„ã€Œé›¶ SEO/GAã€èˆ‡ã€ŒUI/UX ç¾æ„Ÿã€è¦ç¯„ã€‚

### Phase 2: åŠŸèƒ½é é¢é–‹ç™¼ (Feature Pages Development)

**ç›®æ¨™**: åƒç…§ `/admin/sitemap` é é¢çš„çµæ§‹ï¼Œå¯¦ä½œæ‰€æœ‰è¦åŠƒçš„ç®¡ç†é é¢ã€‚

- **[ ] 2.1: å»ºç«‹è³‡æ–™åº«ç¶­é‹æ§åˆ¶å°**
    - **ä½ç½®**: `/admin/database`
    - **è¦æ±‚**:
        - å»ºç«‹ä¸€å€‹æ–°çš„æ ¸å¿ƒå…ƒä»¶ï¼Œå¦‚ `DatabaseConsole.tsx`ã€‚
        - åƒç…§ `SitemapConsole.tsx` çš„çµæ§‹ï¼ŒåŠ å…¥å„€è¡¨æ¿ã€ç‹€æ…‹å¡ç‰‡å’Œã€Œè‡ªå‹•åŒ–ç®¡ç†ã€å€å¡Šã€‚
        - **å„€è¡¨æ¿/ç‹€æ…‹å¡ç‰‡** å¯é¡¯ç¤ºè³‡æ–™åº«é€£ç·šç‹€æ…‹ã€é›†åˆæ•¸é‡ã€å‚™ä»½æ™‚é–“ç­‰ã€‚
        - **ä»»å‹™æŒ‰éˆ•** éœ€å°æ‡‰ 4.1 ç¯€ä¸­æ‰€æœ‰ `db:*` çš„è…³æœ¬ã€‚
        - **å…§å®¹æª¢è¦–å™¨** å¯é¡¯ç¤ºå¦‚ `db:list` çš„åŸ·è¡Œçµæœã€‚

- **[ ] 2.2: å»ºç«‹ç³»çµ±è¨ºæ–·æ§åˆ¶å°**
    - **ä½ç½®**: `/admin/system`
    - **è¦æ±‚**:
        - å»ºç«‹ä¸€å€‹æ–°çš„æ ¸å¿ƒå…ƒä»¶ï¼Œå¦‚ `SystemConsole.tsx`ã€‚
        - åƒç…§ `SitemapConsole.tsx` çš„çµæ§‹ã€‚
        - **å„€è¡¨æ¿/ç‹€æ…‹å¡ç‰‡** å¯é¡¯ç¤ºæ ¼å¼åŒ–ã€Linter æª¢æŸ¥çµæœçš„æ‘˜è¦ã€‚
        - **ä»»å‹™æŒ‰éˆ•** éœ€å°æ‡‰ 4.1 ç¯€ä¸­ `health:*`, `format:*`, `lint` çš„æ‰€æœ‰è…³æœ¬ã€‚
        - **å…§å®¹æª¢è¦–å™¨** å¯é¡¯ç¤ºå¦‚ `lint` çš„è©³ç´°å ±å‘Šã€‚

### Phase 3: é©—æ”¶èˆ‡äº¤ä»˜ (Finalization)
- **[ ] 3.1: å®Œæ•´åŠŸèƒ½æ¸¬è©¦**: ç¢ºä¿æ¯å€‹æŒ‰éˆ•éƒ½èƒ½æ­£ç¢ºåŸ·è¡Œå°æ‡‰çš„è…³æœ¬ä¸¦å›å‚³çµæœã€‚
- **[ ] 3.2: å®‰å…¨æ€§å¯©æŸ¥**: å†æ¬¡ç¢ºèª API çš„ Secret Token æ¬Šé™æ§ç®¡æ˜¯å¦åˆ°ä½ã€‚
- **[ ] 3.3: æ›´æ–°æœ¬æ–‡ä»¶**: å°‡æ‰€æœ‰å·²å®Œæˆçš„é …ç›®æ‰“å‹¾ï¼Œä¸¦åœ¨é€²åº¦è¿½è¹¤ä¸­è¨˜éŒ„æœ€çµ‚ç‰ˆæœ¬è™Ÿã€‚




---

## 4. ç¯„åœé‚Šç•Œ (Scope Boundaries)

### 4.1. ç´å…¥ç¯„åœçš„ Scripts (Whitelist)
- **Sitemap Management**: `sitemap:test`, `sitemap:monitor`, `sitemap:stop`, `sitemap:status`, `sitemap:clear`
- **Database Operations**: `db:init`, `db:connect`, `db:backup`, `db:backup:core`, `db:restore`, `db:list`, `db:clean`
- **System Diagnostics**: `health:check`, `format:check`, `lint`

### 4.2. æ’é™¤ç¯„åœçš„ Scripts (Blacklist)
ä»¥ä¸‹é¡å‹çš„ Scripts å› å…¶é«˜é¢¨éšªæ€§æˆ–ä¸é©åˆåœ¨ Web UI ä¸­åŸ·è¡Œï¼Œè¢«æ˜ç¢ºæ’é™¤ï¼š
- **æœå‹™ç”Ÿå‘½é€±æœŸ**: æ‰€æœ‰ `docker:*`, `start:*`, `stop`, `dev`, `build`, `start`ã€‚
- **ç ´å£æ€§æ“ä½œ**: `docker:purge`, `fix:deps`ã€‚
- **éƒ¨ç½²æµç¨‹**: `deploy:prod`ã€‚

## 5. é–‹ç™¼é€²åº¦è¿½è¹¤ (Development Log)

*(æ¯æ¬¡æäº¤ç¨‹å¼ç¢¼æ™‚ï¼Œè«‹åœ¨æ­¤è™•æ–°å¢ä¸€ç­†æ—¥èªŒ)*

- **2025-06-18**: `AI` - å»ºç«‹ Database æ§åˆ¶å°åŸºç¤æ¶æ§‹ã€‚
- **2025-06-18**: `Yippine/AI` - æ­£å¼ä¸Šç‰ˆ v1ï¼Œç¢ºç«‹å«ç¨ç«‹çµ‚ç«¯æ©Ÿçš„é»ƒé‡‘æ¨™æº–ã€‚
- **2025-06-18**: `AI` - é‡å»º `/admin/sitemap` é é¢ï¼Œç¢ºç«‹æ•´åˆå¼æ§åˆ¶å°çš„é»ƒé‡‘æ¨™æº–ã€‚
- **2025-06-17**: `Yippine/AI` - å»ºç«‹ Admin Console åŸºç¤æ¶æ§‹ (Layout, API, TaskRunnerCard)ã€‚

- `YYYY-MM-DD`: `[Your Name/AI]` - `[Description of work done]`