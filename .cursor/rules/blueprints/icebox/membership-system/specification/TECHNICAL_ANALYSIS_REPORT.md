# Corp-Insight æœƒå“¡ç³»çµ±æŠ€è¡“åˆ†æå ±å‘Š

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

**ç›®æ¨™**ï¼šç‚º Corp-Insight å»ºç«‹ç¬¬ä¸‰æ–¹ç™»å…¥å½¢å¼çš„æœƒå“¡ç™»å…¥ã€ç®¡ç†ç³»çµ±  
**æŠ€è¡“æ£§**ï¼šNext.js + MongoDB + TypeScript + Docker  
**æ ¸å¿ƒéœ€æ±‚**ï¼šGoogle/Facebook/LINE OAuth ç™»å…¥ + ä¼æ¥­ç´šå¾Œå°ç®¡ç†  

## ğŸ¯ æœ€çµ‚æ¨è–¦æ–¹æ¡ˆï¼šPayload CMS + NextAuth.js

### æ ¸å¿ƒæ¶æ§‹
```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Next.js App        â”‚ â† ä¸»æ‡‰ç”¨ç¨‹å¼
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Payload CMS   â”‚    â”‚ â† ç›´æ¥å®‰è£åœ¨ Next.js å…§
â”‚  â”‚  (Admin Panel)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   NextAuth.js   â”‚    â”‚ â† ç¬¬ä¸‰æ–¹ç™»å…¥
â”‚  â”‚ (OAuth Provider)â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    MongoDB      â”‚ â† çµ±ä¸€è³‡æ–™åº«
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ æ±ºç­–éç¨‹èˆ‡åˆ†æ

### 1. ç ”ç©¶éç¨‹
1. **RuoYi-Vue-Pro è©•ä¼°**ï¼šåŠŸèƒ½å®Œæ•´ä½†æŠ€è¡“æ£§ä¸åŒ¹é…
2. **AWS Cognito è€ƒé‡**ï¼šæˆæœ¬èˆ‡æŠ€è¡“å‚µå•é¡Œ
3. **é–‹æº IAM æ–¹æ¡ˆç ”ç©¶**ï¼šæˆæ¬Šæ¢æ¬¾é™åˆ¶å•é¡Œ
4. **Next.js ç”Ÿæ…‹èª¿ç ”**ï¼šç™¼ç¾ Payload CMS æœ€ä½³åŒ¹é…

### 2. æŠ€è¡“æ£§æ¯”è¼ƒåˆ†æ

#### æ’é™¤çš„æ–¹æ¡ˆåŠåŸå› 

**âŒ RuoYi-Vue-Pro**
- **æŠ€è¡“éšœç¤™**ï¼šJava + Spring Boot vs Next.js + Node.js
- **æ•´åˆè¤‡é›œåº¦**ï¼šéœ€è¦ç¶­è­·é›™æŠ€è¡“æ£§
- **åŠŸèƒ½å†—é¤˜**ï¼šåªéœ€è¦ 15-20% åŠŸèƒ½ï¼Œæ‰¿è¼‰ 100% è¤‡é›œåº¦

**âŒ Strapi CMS**
- **æˆæ¬Šé¢¨éšª**ï¼šä¼æ¥­ç‰ˆåŠŸèƒ½é MIT æˆæ¬Š
- **SSO é™åˆ¶**ï¼šåŸºæœ¬ SSO åŠŸèƒ½å±¬æ–¼ä¼æ¥­ç‰ˆ

**âŒ AWS Cognito**
- **æˆæœ¬è€ƒé‡**ï¼š10è¬ç”¨æˆ¶ç´„ 40,500 TWD/æœˆ
- **æŠ€è¡“å‚µå‹™**ï¼šé›™è³‡æ–™åº«åŒæ­¥å•é¡Œ

**âŒ é–‹æº IAM æ–¹æ¡ˆï¼ˆKeycloak, Authentik ç­‰ï¼‰**
- **æŠ€è¡“æ£§ä¸åŒ¹é…**ï¼šå¤§å¤šç‚º Java/Python æŠ€è¡“æ£§
- **è¤‡é›œåº¦éé«˜**ï¼šä¼æ¥­ç´šåŠŸèƒ½è¶…å‡º MVP éœ€æ±‚

### 3. Payload CMS å„ªå‹¢åˆ†æ

#### âœ… æŠ€è¡“åŒ¹é…åº¦ 100%
```typescript
// å®Œç¾æŠ€è¡“æ£§åŒ¹é…
- MIT æˆæ¬Š âœ…
- Native Next.js 3.0 æ”¯æ´ âœ…
- MongoDB åŸç”Ÿæ”¯æ´ âœ…
- TypeScript åŸç”Ÿ âœ…
- Node.js ç”Ÿæ…‹ âœ…
- Docker å‹å¥½ âœ…
```

#### âœ… åŠŸèƒ½å®Œæ•´æ€§
```typescript
// Payload CMS è‡ªå‹•æä¾›çš„åŠŸèƒ½ï¼ˆ0 é–‹ç™¼æ™‚é–“ï¼‰
âœ… ç”¨æˆ¶ç®¡ç†å¾Œå°ç•Œé¢
âœ… è§’è‰²æ¬Šé™ç³»çµ±ï¼ˆRBACï¼‰
âœ… å…§å»ºèªè­‰ç³»çµ±
âœ… RESTful + GraphQL API
âœ… æª”æ¡ˆä¸Šå‚³ç®¡ç†
âœ… è‡ªå‹•åŒ– Admin UI
âœ… è³‡æ–™é©—è­‰å’Œå®‰å…¨æ€§
```

#### âœ… èˆ‡ NextAuth.js å®Œç¾æ•´åˆ
```typescript
// ç¬¬ä¸‰æ–¹ç™»å…¥ + å¾Œå°ç®¡ç†çš„å®Œç¾çµåˆ
NextAuth.js: Google, Facebook, LINE OAuth
     â†“
MongoDB: çµ±ä¸€ç”¨æˆ¶è³‡æ–™
     â†“  
Payload CMS: å¾Œå°ç®¡ç†ç•Œé¢
```

### 4. æ–¹æ¡ˆæ¯”è¼ƒè¡¨

| æ–¹æ¡ˆ | é–‹ç™¼æ™‚é–“ | æŠ€è¡“å‚µ | åŠŸèƒ½å®Œæ•´åº¦ | æˆæ¬Šé¢¨éšª | ä¸»ç®¡æ»¿æ„åº¦ |
|------|----------|--------|------------|----------|------------|
| RuoYi æ•´åˆ | 6 é€± | æ¥µé«˜ | 120% | ç„¡ | â­â­â­ |
| Keycloak + Next.js | 4 é€± | é«˜ | 90% | ç„¡ | â­â­â­â­ |
| ç´” NextAuth è‡ªå»º | 3 é€± | ä¸­ | 60% | ç„¡ | â­â­â­ |
| **Payload + NextAuth** | **2 é€±** | **æ¥µä½** | **95%** | **ç„¡** | **â­â­â­â­â­** |

## ğŸš€ BMad Method å¯¦ä½œè¨ˆåŠƒ

### ä½¿ç”¨è€…æ•…äº‹æ‹†åˆ†
```typescript
const userStories = [
  "US001: OAuth Google ç™»å…¥æ•´åˆ",
  "US002: OAuth Facebook ç™»å…¥æ•´åˆ", 
  "US003: OAuth LINE ç™»å…¥æ•´åˆ",
  "US004: ç”¨æˆ¶è³‡æ–™ç®¡ç†é é¢",
  "US005: æ¬Šé™é©—è­‰ä¸­é–“ä»¶",
  "US006: Admin å¾Œå°ç”¨æˆ¶ç®¡ç†",
  "US007: æœƒå“¡å°ˆå±¬åŠŸèƒ½å±•ç¤º",
  "US008: ä»˜è²»æœƒå“¡é å‚™åŠŸèƒ½",
  // æ¯å€‹ Agent å°ˆæ³¨è™•ç†ä¸€å€‹æ•…äº‹
]
```

### é–‹ç™¼æ™‚ç¨‹è¦åŠƒ

#### ç¬¬ 1 é€±ï¼šåŸºç¤æ¶æ§‹ï¼ˆ3 å€‹ Agent ä¸¦è¡Œï¼‰
```bash
Agent 1: å®‰è£ Payload CMS åˆ°ç¾æœ‰ Next.js å°ˆæ¡ˆ
Agent 2: é…ç½® NextAuth.js + MongoDB Adapter
Agent 3: è¨­å®š OAuth Providers (Google, Facebook, LINE)
```

#### ç¬¬ 2 é€±ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ5 å€‹ User Story ä¸¦è¡Œï¼‰
```bash
US001: ç¬¬ä¸‰æ–¹ç™»å…¥æµç¨‹æ•´åˆ
US002: ç”¨æˆ¶è³‡æ–™åŒæ­¥ï¼ˆNextAuth â†” Payloadï¼‰
US003: æœƒå“¡æ¬Šé™ä¸­é–“ä»¶
US004: Admin å¾Œå°ç”¨æˆ¶ç®¡ç†
US005: å‰å°æœƒå“¡å°ˆå±¬åŠŸèƒ½
```

#### ç¬¬ 3 é€±ï¼šå„ªåŒ–èˆ‡æ“´å±•
```bash
US006: ä»˜è²»æœƒå“¡æº–å‚™åŠŸèƒ½
US007: ä½¿ç”¨è¡Œç‚ºè¨˜éŒ„
US008: æ•´åˆæ¸¬è©¦èˆ‡éƒ¨ç½²
```

## ğŸ’» æŠ€è¡“å¯¦ä½œæŒ‡å—

### ç’°å¢ƒé…ç½®

#### æ­¥é©Ÿ 1ï¼šå®‰è£ Payload CMS
```bash
cd /projects/Corp-Insight/next
npx create-payload-app@latest --template blank
# æˆ–ç›´æ¥å®‰è£åˆ°ç¾æœ‰å°ˆæ¡ˆ
npm install payload @payloadcms/db-mongodb
```

#### æ­¥é©Ÿ 2ï¼šæ•´åˆ NextAuth.js
```bash
npm install next-auth @next-auth/mongodb-adapter
```

#### æ­¥é©Ÿ 3ï¼šå¿…è¦å¥—ä»¶
```bash
npm install @payloadcms/bundler-webpack @payloadcms/richtext-slate
```

### æ ¸å¿ƒé…ç½®

#### Payload CMS é…ç½®
```typescript
// payload.config.ts
import { buildConfig } from 'payload/config'
import { mongooseAdapter } from '@payloadcms/db-mongodb'
import { webpackBundler } from '@payloadcms/bundler-webpack'
import { slateEditor } from '@payloadcms/richtext-slate'

export default buildConfig({
  admin: {
    bundler: webpackBundler(),
  },
  editor: slateEditor(),
  db: mongooseAdapter({
    url: process.env.DATABASE_URI, // èˆ‡ NextAuth å…±ç”¨
  }),
  collections: [
    {
      slug: 'users',
      auth: true,
      admin: {
        useAsTitle: 'email',
      },
      fields: [
        {
          name: 'role',
          type: 'select',
          options: ['admin', 'member', 'guest'],
          defaultValue: 'member',
        },
        {
          name: 'memberLevel',
          type: 'select',
          options: ['free', 'premium', 'enterprise'],
          defaultValue: 'free',
        },
      ],
    },
  ],
})
```

#### NextAuth.js é…ç½®
```typescript
// pages/api/auth/[...nextauth].ts
import NextAuth from 'next-auth'
import GoogleProvider from 'next-auth/providers/google'
import FacebookProvider from 'next-auth/providers/facebook'
import { MongoDBAdapter } from '@next-auth/mongodb-adapter'
import { MongoClient } from 'mongodb'

const client = new MongoClient(process.env.MONGODB_URI!)
const clientPromise = client.connect()

export default NextAuth({
  adapter: MongoDBAdapter(clientPromise),
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    FacebookProvider({
      clientId: process.env.FACEBOOK_CLIENT_ID!,
      clientSecret: process.env.FACEBOOK_CLIENT_SECRET!,
    }),
    // LINE Provider é…ç½®
  ],
  callbacks: {
    async session({ session, user }) {
      // æ•´åˆ Payload CMS ç”¨æˆ¶è³‡æ–™
      return session
    },
  },
})
```

#### æ¬Šé™ä¸­é–“ä»¶
```typescript
// middleware.ts
import { withAuth } from 'next-auth/middleware'

export default withAuth(
  function middleware(req) {
    // æœƒå“¡æ¬Šé™é©—è­‰é‚è¼¯
  },
  {
    callbacks: {
      authorized: ({ token, req }) => {
        // æª¢æŸ¥ç”¨æˆ¶æ¬Šé™
        return !!token
      },
    },
  }
)

export const config = {
  matcher: ['/dashboard/:path*', '/premium/:path*']
}
```

### è³‡æ–™åº«æ¶æ§‹

#### MongoDB Collections
```javascript
// users collection (NextAuth + Payload å…±ç”¨)
{
  _id: ObjectId,
  name: String,
  email: String,
  image: String,
  accounts: [...], // ç¬¬ä¸‰æ–¹å¸³è™Ÿé—œè¯
  sessions: [...], // ç™»å…¥æœƒè©±
  
  // Payload CMS æ“´å±•æ¬„ä½
  role: String, // 'admin', 'member', 'guest'
  memberLevel: String, // 'free', 'premium', 'enterprise'
  
  // æ¥­å‹™é‚è¼¯æ¬„ä½
  preferences: Object,
  usageHistory: Array,
  subscriptionStatus: String,
  paymentHistory: Array,
  
  createdAt: Date,
  updatedAt: Date,
  lastLoginAt: Date
}
```

## ğŸ”’ å®‰å…¨æ€§èˆ‡æœ€ä½³å¯¦è¸

### ç’°å¢ƒè®Šæ•¸é…ç½®
```bash
# .env.local
DATABASE_URI=mongodb://localhost:27017/corp-insight
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key

# OAuth é…ç½®
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
FACEBOOK_CLIENT_ID=your-facebook-client-id
FACEBOOK_CLIENT_SECRET=your-facebook-client-secret
LINE_CLIENT_ID=your-line-client-id
LINE_CLIENT_SECRET=your-line-client-secret

# Payload CMS
PAYLOAD_SECRET=your-payload-secret
```

### Docker é…ç½®æ›´æ–°
```yaml
# docker-compose.dev.yml ä¸­åŠ å…¥
services:
  app-dev:
    environment:
      - DATABASE_URI=mongodb://mongo:27017/corp-insight
      - NEXTAUTH_URL=http://localhost:3000
      # å…¶ä»–ç’°å¢ƒè®Šæ•¸...
```

## ğŸ“ˆ æœªä¾†æ“´å±•è¦åŠƒ

### ä»˜è²»åŠŸèƒ½æº–å‚™
```typescript
// æœƒå“¡ç­‰ç´šé‚è¼¯
const memberPermissions = {
  free: ['basic_tools', 'limited_queries'],
  premium: ['advanced_tools', 'unlimited_queries', 'priority_support'],
  enterprise: ['all_features', 'custom_integrations', 'dedicated_support']
}

// ä½¿ç”¨è¨˜éŒ„è¿½è¹¤
interface UsageRecord {
  userId: string
  feature: string
  timestamp: Date
  metadata: object
}
```

### Stripe æ•´åˆæº–å‚™
```typescript
// ç‚ºæœªä¾†ä»˜è²»åŠŸèƒ½é ç•™æ¥å£
interface SubscriptionPlan {
  id: string
  name: string
  price: number
  features: string[]
  stripeProductId?: string
}
```

## ğŸ¯ ä¸»ç®¡æºé€šè¦é»

### è«–è¿°ç­–ç•¥
1. **"Payload CMS æ˜¯é–‹æºç•Œçš„ RuoYi"** - åŒæ¨£ä¼æ¥­ç´šã€åŒæ¨£åŠŸèƒ½å®Œæ•´
2. **"æŠ€è¡“æ£§çµ±ä¸€"** - é¿å… Java + Node.js é›™æŠ€è¡“æ£§ç¶­è­·è² æ“”  
3. **"å¾Œå°ç®¡ç†å®Œæ•´"** - æ»¿è¶³ä»˜è²»æœƒå“¡ã€ç”¨æˆ¶ç®¡ç†ç­‰éœ€æ±‚
4. **"BMad Method åŠ é€Ÿ"** - AI é©…å‹•é–‹ç™¼ï¼Œæ•ˆç‡å€å¢
5. **"MIT æˆæ¬Šå®‰å…¨"** - ç„¡ä»»ä½•æˆæ¬Šé¢¨éšªæˆ–é™åˆ¶

### é æœŸæ•ˆç›Š
- **é–‹ç™¼æ™‚é–“ç¸®çŸ­ 50%**ï¼š2 é€± vs 4-6 é€±å‚³çµ±é–‹ç™¼
- **ç¶­è­·æˆæœ¬é™ä½ 70%**ï¼šçµ±ä¸€æŠ€è¡“æ£§ï¼Œæ¸›å°‘è¤‡é›œåº¦
- **åŠŸèƒ½å®Œæ•´åº¦ 95%**ï¼šä¼æ¥­ç´šå¾Œå° + å®Œæ•´èªè­‰ç³»çµ±
- **æœªä¾†æ“´å±•å‹å¥½**ï¼šAI æ•´åˆã€ä»˜è²»åŠŸèƒ½éƒ½å®¹æ˜“åŠ å…¥

## ğŸš€ ç«‹å³é–‹å§‹

### ç¬¬ä¸€æ­¥åŸ·è¡ŒæŒ‡ä»¤
```bash
cd /projects/Corp-Insight/next
npx payload create-payload-app
```

### æˆåŠŸæŒ‡æ¨™
- [ ] Payload CMS æˆåŠŸæ•´åˆåˆ° Next.js
- [ ] NextAuth.js ç¬¬ä¸‰æ–¹ç™»å…¥æ­£å¸¸é‹ä½œ
- [ ] MongoDB çµ±ä¸€è³‡æ–™åº«é…ç½®å®Œæˆ
- [ ] Admin å¾Œå°å¯æ­£å¸¸ç®¡ç†ç”¨æˆ¶
- [ ] æœƒå“¡æ¬Šé™ä¸­é–“ä»¶é‹ä½œæ­£å¸¸

---

**çµè«–**ï¼šé€™å€‹æ–¹æ¡ˆè®“é–‹ç™¼è€…å¯ä»¥**å°ˆæ³¨æ–¼ Generative AI é–‹ç™¼**ï¼Œè€Œæœƒå“¡ç³»çµ±å®Œå…¨ä¸éœ€è¦é‡é€ è¼ªå­ï¼Œæ—¢æ»¿è¶³ä¸»ç®¡å°ä¼æ¥­ç´šå¾Œå°çš„æœŸæœ›ï¼Œåˆä¿æŒäº†æŠ€è¡“æ£§çš„çµ±ä¸€æ€§å’Œé–‹ç™¼æ•ˆç‡çš„æœ€å¤§åŒ–ã€‚

*å ±å‘Šå»ºç«‹æ™‚é–“ï¼š2025-08-14*  
*æŠ€è¡“æ£§ï¼šNext.js + Payload CMS + NextAuth.js + MongoDB*  
*é è¨ˆå®Œæˆæ™‚é–“ï¼š2-3 é€±*