# 檔案管理與封存規範

## 檔案拆分規範

### 400 行限制檢查
任何新建立的文件若超過 400 行，必須主動提醒並建議拆分：

```
⚠️  此檔案已達到 XXX 行，超過 400 行限制
建議拆分方案：
1. 按功能模組拆分
2. 按職責領域拆分  
3. 建立主索引檔案
```

### 拆分策略
1. **功能導向拆分**：按不同功能需求分割
2. **職責導向拆分**：按不同角色職責分割
3. **保持主檔案**：建立索引檔案引導到拆分後的子檔案

### 拆分後的檔案組織
```
原始檔案.md (超過 400 行) →
├── 原始檔案.md (主索引，< 100 行)
├── 子功能-1.md
├── 子功能-2.md  
└── 子功能-3.md
```

## 功能封存機制

### 封存目錄結構
```
docs/
├── features/           # 活躍開發功能
├── archive/           # 封存功能（直接放功能目錄）
│   ├── gemini-api-pool/      # 已完成功能
│   ├── prompt-studio/        # 已取消功能  
│   └── basic-sitemap/        # 已整合功能
└── archive-status.md  # 封存狀態說明
```

### 封存觸發時機
- ✅ **功能開發完成**：經過 QA 驗收通過
- 🔄 **功能需求變更**：產品需求調整導致暫停
- 📋 **功能整合完成**：併入其他功能模組  
- ⚠️ **技術方案變更**：技術決策改變導致廢棄

### 封存執行流程
1. **移動功能目錄**：從 `features/` 移到 `archive/`
2. **更新封存狀態**：在 `archive-status.md` 中記錄
3. **更新專案狀態**：修改 `project-status.yml`

## BMad Method 相容性

### Agent 職責分工
- **PO**：決定功能封存時機與原因
- **Architect**：評估技術方案變更影響
- **SM**：執行封存流程，更新狀態追蹤
- **Dev**：確保功能整合或移植完成  
- **QA**：驗收功能完成狀態

### 與既有 Cursor Rules 相容
- 保留 `.cursor/rules/blueprints/archive/` 作為歷史參考
- 不重複建立相同內容的封存記錄
- 新的功能開發優先使用 BMad Method 結構
- **BMad Method 詳細說明**：`docs/features/README.md`
- **Claude Code 整合**：`.claude/commands/` 指令系統

## 封存狀態管理

### archive-status.md 格式
每個封存功能在此檔案中記錄一筆：

```markdown
## gemini-api-pool
- **封存日期**：2025-08-18
- **封存原因**：功能開發完成
- **最終狀態**：completed
- **相關文件**：archive/gemini-api-pool/
- **整合狀態**：已整合到核心系統

## prompt-studio  
- **封存日期**：2025-08-15
- **封存原因**：需求變更，優先順序調整
- **最終狀態**：cancelled
- **相關文件**：archive/prompt-studio/
- **未來計畫**：可能在 v2.0 重新評估
```

## 檔案命名與組織規範

### 功能目錄結構標準
每個功能模組應包含：
```
feature-name/
├── README.md          # 功能概述
├── prd/              # 產品需求（PO 負責）
├── architecture/     # 技術架構（Architect 負責）
├── epics/           # Epic 管理（SM 負責）
├── stories/         # Story 開發（Dev 參考）
└── testing/         # 測試文件（QA 負責）
```

### 檔案命名慣例
- 使用 kebab-case 英文命名
- 檔案名稱清楚表達用途
- Epic：`epic-{number}-{name}.md`
- Story：`{number}.{number}.{name}.md`

## 清理與維護

### 定期檢查項目
1. **檔案大小檢查**：每月檢查是否有檔案超過 400 行
2. **封存狀態更新**：每季檢視封存功能是否需要永久移除
3. **功能目錄整理**：移除空白或無效的功能目錄

### 維護職責
- **SM**：負責定期檢查與清理工作
- **所有 Agent**：發現問題時主動回報與修正