# æç¤ºè©å„ªåŒ–è³‡æ–™æµ

```mermaid
flowchart TD
    Start["ğŸ”§ ç®¡ç†å“¡é»æ“Šå„ªåŒ–æŒ‰éˆ•"] --> Component["PromptEditor<br/>(çµ„ä»¶)"]
    Component --> Hook["usePromptEngine<br/>(React Hook)"]
    Hook --> API["/api/prompt/optimize<br/>(API ç«¯é»)"]
    API --> ServerFunc["generateOptimizedPrompt()"]

    ServerFunc --> OptimizationProcess["ğŸ“ æç¤ºè©å„ªåŒ–æµç¨‹"]

    subgraph OptimizationProcess["ğŸ“ æç¤ºè©å„ªåŒ–æµç¨‹"]
        direction TB
        Step1["1ï¸âƒ£ è¼‰å…¥å…ƒæç¤ºè©ç¯„æœ¬<br/>(prompt_templates)"]
        Step2["2ï¸âƒ£ æŸ¥è©¢å·¥å…·è³‡æ–™<br/>(AITool Model)"]
        Step3["3ï¸âƒ£ å»ºç«‹è¶…ç´šæç¤ºè©<br/>(è®Šæ•¸æ›¿æ› + ä¸Šä¸‹æ–‡çµ„åˆ)"]
        Step4["4ï¸âƒ£ å‘¼å« Gemini API<br/>(é€éé‡‘é‘°æ± ç³»çµ±)"]

        Step1 --> Step2
        Step2 --> Step3
        Step3 --> Step4
    end

    OptimizationProcess --> GeminiAPI["ğŸ¤– Gemini 2.5 Flash Latest"]
    GeminiAPI --> Result["ğŸ“Š å„ªåŒ–å¾Œçš„æç¤ºè©"]
    Result --> EditorUpdate["å‰ç«¯ç·¨è¼¯å™¨æ›´æ–°"]
    EditorUpdate --> SaveAPI["/api/aitool/update-prompt<br/>(å„²å­˜ API)"]
    SaveAPI --> MongoDB["ğŸ’¾ MongoDB<br/>AIToolModel æ›´æ–°"]
    MongoDB --> End["âœ… å®Œæˆå„ªåŒ–ä¸¦å„²å­˜"]

    classDef userClass fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef componentClass fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef hookClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef apiClass fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef processClass fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef aiClass fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef dataClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px

    class Start,End userClass
    class Component componentClass
    class Hook hookClass
    class API,SaveAPI apiClass
    class ServerFunc,Step1,Step2,Step3,Step4 processClass
    class GeminiAPI aiClass
    class Result,EditorUpdate,MongoDB dataClass
```
